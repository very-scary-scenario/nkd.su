{% extends parent %}
{% load vote_tags %}

{% block content %}
  <h2>requests</h2>

  {% if object_list %}
    <ul id="requests">
      {% for object in object_list %}
        <li class="
          {% if object.claimant %}
            claimed
            {% if object.claimant == request.user %}
              mine
            {% endif %}
          {% endif %}
        ">
          <h3>{{ object.created }}</h3>

          {% if object.submitted_by %}
            <p class="claimant">
              submitted by <a href="{{ object.submitted_by.profile.get_absolute_url }}">@{{ object.submitted_by.username }}</a>
            </p>
          {% endif %}

          {% if object.claimant %}
            <p class="claimant">
              claimed by <a href="{{ object.claimant.profile.get_absolute_url }}">@{{ object.claimant.username }}</a>
            </p>
          {% endif %}

          <dl>
            {% if object.track %}
              <dt>track</dt>
              <dd><a href="{{ object.track.get_absolute_url }}">{{ object.track }}</a></dd>
            {% endif %}
            {% for k, v in object.non_metadata.items %}
              <dt>{{ k }}</dt>
              <dd>{{ v }}</dd>
            {% endfor %}
          </dl>

          <form action="{% url "vote:admin:claim_request" pk=object.pk %}" method="post">
            {% csrf_token %}

            {% if not object.claimant %}
              <input class="button" type="submit" name="claim" value="Claim">
            {% elif object.claimant == request.user %}
              <input class="button" type="submit" name="unclaim" value="Unclaim">
            {% endif %}
          </form>

          <form action="{% url "vote:admin:fill_request" pk=object.pk %}" method="post">
            {% csrf_token %}
            <input class="button" type="submit" value="Mark as filled">
          </form>

          <form action="{% url "vote:admin:shelf_request" pk=object.pk %}" method="post">
            {% csrf_token %}
            <input name="reason" type="text" placeholder="why?">
            {% if not object.is_shelved %}
              <input name="shelf" class="button" type="submit" value="Shelf">
            {% else %}
              <input name="unshelf" class="button" type="submit" value="Unshelf">
            {% endif %}
          </form>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="subheading">There's nothing here.</p>
  {% endif %}
{% endblock %}
